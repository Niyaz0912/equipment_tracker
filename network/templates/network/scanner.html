<!-- network/templates/network/scanner.html -->
{% extends 'base.html' %}
{% load static %}

{% block title %}Сканер сети - Equipment Tracker{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <!-- Сайдбар -->
        <div class="col-md-3 col-lg-2 d-md-block sidebar collapse">
            <div class="position-sticky pt-3">
                {% include 'network/partials/_sidebar.html' %}
            </div>
        </div>
        
        <!-- Основной контент -->
        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                <h1 class="h2">
                    <i class="bi bi-wifi"></i> Сканер сети
                </h1>
            </div>

            <!-- Информационная карточка -->
            <div class="row">
                <div class="col-md-8">
                    <div class="card">
                        <div class="card-header bg-primary text-white">
                            <i class="bi bi-gear"></i> Настройки сканирования
                        </div>
                        <div class="card-body">
                            <form method="POST" action="{% url 'network:scan_results' %}">
                                {% csrf_token %}
                                
                                <div class="mb-3">
                                    <label for="network" class="form-label">
                                        <i class="bi bi-diagram-3"></i> Сеть для сканирования
                                    </label>
                                    <div class="input-group">
                                        <span class="input-group-text">CIDR</span>
                                        <input type="text" 
                                               class="form-control" 
                                               id="network" 
                                               name="network" 
                                               value="{{ detected_network }}"
                                               placeholder="192.168.1.0/24"
                                               required>
                                    </div>
                                    <div class="form-text">
                                        Укажите сеть в формате CIDR (например: 192.168.1.0/24)
                                    </div>
                                </div>
                                
                                <div class="mb-4">
                                    <div class="alert alert-info">
                                        <i class="bi bi-info-circle"></i>
                                        <strong>Информация:</strong>
                                        <ul class="mb-0 mt-2">
                                            <li>Сканирование может занять 1-2 минуты</li>
                                            <li>Для сканирования требуются права администратора</li>
                                            <li>Рекомендуется сканировать в нерабочее время</li>
                                        </ul>
                                    </div>
                                </div>
                                
                                <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                    <a href="{% url 'network:network_map' %}" class="btn btn-outline-secondary me-md-2">
                                        <i class="bi bi-arrow-left"></i> Назад
                                    </a>
                                    <button type="submit" class="btn btn-primary">
                                        <i class="bi bi-play-circle"></i> Запустить сканирование
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                    
                    <!-- Предупреждение если что-то не так -->
                    {% if not scanner_available %}
                    <div class="alert alert-warning mt-3">
                        <i class="bi bi-exclamation-triangle"></i>
                        <strong>Внимание:</strong> Модуль сканера недоступен. Установите python-nmap.
                    </div>
                    {% endif %}
                </div>
                
                <div class="col-md-4">
                    <!-- Быстрые сети -->
                    <div class="card">
                        <div class="card-header bg-light">
                            <i class="bi bi-lightning"></i> Быстрый выбор
                        </div>
                        <div class="card-body">
                            <p class="card-text">Часто используемые сети:</p>
                            <div class="d-grid gap-2">
                                <a href="?network=192.168.1.0/24" class="btn btn-outline-primary">
                                    192.168.1.0/24
                                </a>
                                <a href="?network=192.168.0.0/24" class="btn btn-outline-primary">
                                    192.168.0.0/24
                                </a>
                                <a href="?network=10.0.0.0/24" class="btn btn-outline-primary">
                                    10.0.0.0/24
                                </a>
                                <a href="?network=172.16.0.0/24" class="btn btn-outline-primary">
                                    172.16.0.0/24
                                </a>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Статистика -->
                    <div class="card mt-3">
                        <div class="card-header bg-light">
                            <i class="bi bi-graph-up"></i> Статистика
                        </div>
                        <div class="card-body">
                            <p class="card-text">В базе данных:</p>
                            <div class="row text-center">
                                <div class="col-6">
                                    <h4>{{ total_equipment }}</h4>
                                    <small class="text-muted">Оборудование</small>
                                </div>
                                <div class="col-6">
                                    <h4>{{ active_count }}</h4>
                                    <small class="text-muted">Активных</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Инструкция -->
            <div class="card mt-4">
                <div class="card-header bg-light">
                    <i class="bi bi-book"></i> Как это работает?
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <h5><i class="bi bi-1-circle text-primary"></i> Определение сети</h5>
                            <p>Система автоматически определяет вашу локальную сеть на основе сетевых настроек.</p>
                        </div>
                        <div class="col-md-4">
                            <h5><i class="bi bi-2-circle text-primary"></i> Сканирование</h5>
                            <p>Используется ping-сканирование для обнаружения активных устройств в сети.</p>
                        </div>
                        <div class="col-md-4">
                            <h5><i class="bi bi-3-circle text-primary"></i> Анализ</h5>
                            <p>Найденные устройства сравниваются с базой данных, определяется их тип и статус.</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>

<style>
.sidebar {
    background-color: #f8f9fa;
    border-right: 1px solid #dee2e6;
}
.card {
    border: 1px solid #dee2e6;
    border-radius: 0.375rem;
}
.input-group-text {
    background-color: #f8f9fa;
}
</style>
{% endblock %}