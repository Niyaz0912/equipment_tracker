
<!-- network/templates/network/ip_lookup.html -->
{% extends 'base.html' %}
{% load static %}

{% block title %}Поиск IP - Equipment Tracker{% endblock %}

{% block content %}
<!-- Внутренняя навигация -->
{% include 'network/_navigation.html' %}

<div class="container-fluid py-4">
    <!-- Заголовок -->
    <div class="row mb-4">
        <div class="col-md-8">
            <h1><i class="bi bi-search"></i> Поиск IP-адреса</h1>
            <p class="text-muted">Узнайте, какое оборудование использует указанный IP-адрес</p>
        </div>
    </div>

    <!-- Форма поиска -->
    <div class="card mb-4">
        <div class="card-header bg-primary text-white">
            <h5 class="card-title mb-0">
                <i class="bi bi-ip"></i> Введите IP-адрес для поиска
            </h5>
        </div>
        <div class="card-body">
            <form method="get" action="." class="row g-3">
                <div class="col-md-8">
                    <div class="input-group input-group-lg">
                        <span class="input-group-text">
                            <i class="bi bi-123"></i>
                        </span>
                        <input type="text" 
                               name="ip" 
                               class="form-control form-control-lg" 
                               placeholder="Например: 192.168.1.1 или 10.0.0.10"
                               value="{{ ip }}"
                               required>
                    </div>
                    <small class="text-muted mt-2 d-block">
                        Введите IPv4 адрес для поиска в базе данных сети
                    </small>
                </div>
                <div class="col-md-4">
                    <button type="submit" class="btn btn-primary btn-lg w-100">
                        <i class="bi bi-search"></i> Найти IP
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Быстрые IP -->
    <div class="row mb-4">
        <div class="col-md-12">
            <h5><i class="bi bi-lightning"></i> Быстрый поиск:</h5>
            <div class="btn-group flex-wrap" role="group">
                <a href="?ip=192.168.1.1" class="btn btn-outline-primary btn-sm">Шлюз (192.168.1.1)</a>
                <a href="?ip=192.168.1.10" class="btn btn-outline-primary btn-sm">Сервер 1С</a>
                <a href="?ip=192.168.1.50" class="btn btn-outline-primary btn-sm">Принтер</a>
                <a href="?ip=8.8.8.8" class="btn btn-outline-secondary btn-sm">Google DNS</a>
                <a href="?ip=10.0.0.1" class="btn btn-outline-secondary btn-sm">Серверная (10.0.0.1)</a>
            </div>
        </div>
    </div>

    <!-- Результаты поиска -->
    {% if ip %}
    <div class="card">
        <div class="card-header {% if result %}bg-success text-white{% else %}bg-warning text-dark{% endif %}">
            <h5 class="card-title mb-0">
                <i class="bi bi-info-circle"></i> 
                Результат поиска: <code>{{ ip }}</code>
            </h5>
        </div>
        <div class="card-body">
            {% if result %}
                <!-- Найден результат -->
                <div class="alert alert-success">
                    <h5><i class="bi bi-check-circle"></i> IP-адрес найден в базе!</h5>
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <h6>Основная информация:</h6>
                        <table class="table table-sm">
                            <tr>
                                <th>IP-адрес:</th>
                                <td><code>{{ result.address }}</code></td>
                            </tr>
                            <tr>
                                <th>Статус:</th>
                                <td>
                                    <span class="badge 
                                        {% if result.status == 'occupied' %}bg-success
                                        {% elif result.status == 'free' %}bg-secondary
                                        {% elif result.status == 'reserved' %}bg-warning
                                        {% else %}bg-info{% endif %}">
                                        {{ result.get_status_display }}
                                    </span>
                                </td>
                            </tr>
                            <tr>
                                <th>Подсеть:</th>
                                <td>
                                    {% if result.subnet %}
                                    <a href="/network/subnets/{{ result.subnet.id }}/">
                                        {{ result.subnet.network }}
                                    </a>
                                    {% else %}
                                    Не указана
                                    {% endif %}
                                </td>
                            </tr>
                            <tr>
                                <th>Описание:</th>
                                <td>{{ result.description|default:"Не указано" }}</td>
                            </tr>
                        </table>
                    </div>
                    
                    <div class="col-md-6">
                        <h6>Привязка к оборудованию:</h6>
                        {% if result.device %}
                        <div class="card border-primary">
                            <div class="card-body">
                                <h6>
                                    <i class="bi bi-hdd"></i> 
                                    <a href="/network/equipment/{{ result.device.id }}/">
                                        {{ result.device.name }}
                                    </a>
                                </h6>
                                <p class="mb-1">
                                    <strong>Тип:</strong> {{ result.device.get_type_display }}<br>
                                    <strong>Модель:</strong> {{ result.device.model|default:"Не указана" }}<br>
                                    <strong>Место:</strong> {{ result.device.location.name|default:"Не указано" }}
                                </p>
                            </div>
                        </div>
                        {% else %}
                        <p class="text-muted">Не привязан к оборудованию</p>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Дополнительная информация -->
                <div class="row mt-3">
                    <div class="col-md-6">
                        <h6>Сетевая информация:</h6>
                        <table class="table table-sm">
                            <tr>
                                <th>MAC-адрес:</th>
                                <td>
                                    {% if result.mac_address %}
                                    <code>{{ result.mac_address }}</code>
                                    {% else %}
                                    Не указан
                                    {% endif %}
                                </td>
                            </tr>
                            <tr>
                                <th>DNS имя:</th>
                                <td>{{ result.dns_name|default:"Не указано" }}</td>
                            </tr>
                            <tr>
                                <th>Обновлено:</th>
                                <td>{{ result.last_updated|date:"d.m.Y H:i" }}</td>
                            </tr>
                        </table>
                    </div>
                    <div class="col-md-6">
                        <h6>Заметки:</h6>
                        {% if result.note %}
                        <div class="alert alert-light">
                            {{ result.note|linebreaks }}
                        </div>
                        {% else %}
                        <p class="text-muted">Заметок нет</p>
                        {% endif %}
                    </div>
                </div>
                
            {% else %}
                <!-- Не найден -->
                <div class="alert alert-warning">
                    <h5><i class="bi bi-exclamation-triangle"></i> IP-адрес не найден в базе</h5>
                    <p>Это может означать:</p>
                    <ul>
                        <li>IP адрес не зарегистрирован в системе</li>
                        <li>Адрес выдан через DHCP (динамический)</li>
                        <li>Адрес принадлежит другой подсети</li>
                        <li>Ошибка в написании IP-адреса</li>
                    </ul>
                </div>
                
                <div class="text-center mt-3">
                    <a href="/admin/network/ipaddress/add/" class="btn btn-primary">
                        <i class="bi bi-plus-circle"></i> Добавить этот IP в базу
                    </a>
                </div>
            {% endif %}
        </div>
    </div>
    {% endif %}

    <!-- Информация о базе -->
    <div class="row mt-4">
        <div class="col-md-12">
            <div class="card border-info">
                <div class="card-header bg-info text-white">
                    <h6 class="card-title mb-0">
                        <i class="bi bi-database"></i> О базе IP-адресов
                    </h6>
                </div>
                <div class="card-body">
                    <p class="mb-0">
                        База содержит <strong>{{ total_ips|default:"0" }}</strong> зарегистрированных IP-адресов. 
                        Система отслеживает статические адреса, резервирования и основные сетевые устройства.
                        DHCP адреса обычно не вносятся вручную.
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}