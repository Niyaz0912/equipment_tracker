<!-- network/templates/network/network_map.html -->
{% extends 'base.html' %}
{% load static %}

{% block title %}Карта сети - Equipment Tracker{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-3">{% include 'network/network_sidebar.html' %}</div>
    <div class="col-md-9">
        <div class="col-md-9">
            <div
                class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                <h1 class="h2">
                    <i class="bi bi-diagram-3"></i> Карта сети
                </h1>
            </div>

            <!-- Контейнер для данных (скрыт) -->
            <div id="network-data" data-nodes='{{ network_nodes_json|safe }}' style="display: none;"></div>

            <!-- Карта будет здесь -->
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Сетевая топология</h5>
                    <div id="network-map" style="width: 100%; height: 600px; border: 1px solid #ddd;"></div>
                </div>
            </div>
        </div>
    </div>
    {% endblock %}

    {% block extra_js %}
    <script src="https://cdn.jsdelivr.net/npm/vis-network@9.1.9/dist/vis-network.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const container = document.getElementById('network-map');
            const dataElement = document.getElementById('network-data');

            // Получаем данные
            const nodes = JSON.parse(dataElement.dataset.nodes || '[]');
            const edges = [];

            // Создаем простые связи
            nodes.forEach((node, i) => {
                if (i < nodes.length - 1) {
                    edges.push({
                        from: node.id,
                        to: nodes[i + 1].id,
                        arrows: 'to'
                    });
                }
            });

            // Конфигурация сети
            const data = {
                nodes: new vis.DataSet(nodes),
                edges: new vis.DataSet(edges)
            };

            const options = {
                nodes: {
                    shape: 'dot',
                    size: 20,
                    font: {
                        size: 12,
                        color: '#000'
                    }
                },
                edges: {
                    width: 2,
                    color: { color: '#ccc' }
                },
                physics: {
                    enabled: true,
                    stabilization: true
                }
            };

            // Инициализация сети
            new vis.Network(container, data, options);
        });
    </script>
    {% endblock %}