{% extends 'base.html' %}

{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>üìä –°—Ç–∞—Ç—É—Å –ø—Ä–∏–Ω—Ç–µ—Ä–æ–≤</h1>
        <div>
            <a href="{% url 'check_printers' %}" class="btn btn-primary">
                üîÑ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ–π—á–∞—Å
            </a>
        </div>
    </div>
    
    {% if just_checked %}
    <div class="alert alert-info alert-dismissible fade show" role="alert">
        ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ {{ checked_count }} –ø—Ä–∏–Ω—Ç–µ—Ä–æ–≤
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    {% endif %}
    
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">–í—Å–µ–≥–æ –ø—Ä–∏–Ω—Ç–µ—Ä–æ–≤</h5>
                    <p class="card-text display-4">{{ total_printers }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">–° IP-–∞–¥—Ä–µ—Å–æ–º</h5>
                    <p class="card-text display-4">{{ printers_with_ip }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">–ë–µ–∑ IP</h5>
                    <p class="card-text display-4">{{ total_printers|add:"-"|add:printers_with_ip }}</p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="card">
        <div class="card-header">
            <h5 class="mb-0">–°–ø–∏—Å–æ–∫ –ø—Ä–∏–Ω—Ç–µ—Ä–æ–≤</h5>
        </div>
        <div class="card-body p-0">
            <table class="table table-hover mb-0">
                <thead>
                    <tr>
                        <th>–ú–¶ –Ω–æ–º–µ—Ä</th>
                        <th>–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å</th>
                        <th>–ú–æ–¥–µ–ª—å</th>
                        <th>IP-–∞–¥—Ä–µ—Å</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th>–ü–æ—Å–ª–µ–¥–Ω—è—è –ø—Ä–æ–≤–µ—Ä–∫–∞</th>
                        <th>–í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞</th>
                    </tr>
                </thead>
                <tbody>
                    {% for status in printer_statuses %}
                    <tr>
                        <td>
                            <strong>{{ status.printer.mc_number }}</strong>
                        </td>
                        <td>{{ status.printer.brand|default:"-" }}</td>
                        <td>{{ status.printer.model|default:"-" }}</td>
                        <td>
                            {% if status.printer.ip_address %}
                                <code>{{ status.printer.ip_address }}</code>
                            {% else %}
                                <span class="text-danger">–ù–µ—Ç IP</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if status.last_check %}
                                {% if status.last_check.is_online %}
                                    <span class="badge bg-success">‚úÖ –û–Ω–ª–∞–π–Ω</span>
                                {% else %}
                                    <span class="badge bg-danger">‚ùå –û—Ñ–ª–∞–π–Ω</span>
                                {% endif %}
                            {% else %}
                                <span class="badge bg-secondary">–ù–µ –ø—Ä–æ–≤–µ—Ä—è–ª—Å—è</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if status.last_check %}
                                {{ status.last_check.checked_at|date:"d.m.Y H:i" }}
                            {% else %}
                                -
                            {% endif %}
                        </td>
                        <td>
                            {% if status.last_check and status.last_check.response_time %}
                                {{ status.last_check.response_time }} –º—Å
                            {% elif status.last_check %}
                                <small class="text-muted">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</small>
                            {% endif %}
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="7" class="text-center py-4">
                            <div class="text-muted">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –ø—Ä–∏–Ω—Ç–µ—Ä–∞—Ö</div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    
    <div class="mt-4">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">üìù –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å IP-–∞–¥—Ä–µ—Å–∞?</h5>
            </div>
            <div class="card-body">
                <p>–î–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å IP-–∞–¥—Ä–µ—Å–∞ –ø—Ä–∏–Ω—Ç–µ—Ä–æ–≤:</p>
                <ol>
                    <li>–ó–∞–π–¥–∏—Ç–µ –≤ <a href="/admin/equipments/equipment/">–∞–¥–º–∏–Ω–∫—É –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è</a></li>
                    <li>–ù–∞–π–¥–∏—Ç–µ –ø—Ä–∏–Ω—Ç–µ—Ä</li>
                    <li>–î–æ–±–∞–≤—å—Ç–µ –ø–æ–ª–µ "IP-–∞–¥—Ä–µ—Å"</li>
                    <li>–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è</li>
                </ol>
                <p class="mb-0 text-muted">
                    <small>–ü—Ä–∏–Ω—Ç–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø–æ –ø–æ—Ä—Ç—É 9100 (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–æ—Ä—Ç –ø–µ—á–∞—Ç–∏)</small>
                </p>
            </div>
        </div>
    </div>
</div>
{% endblock %}