{% extends 'base.html' %}

{% block title %}–°–ø–∏—Å–æ–∫ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="mb-0">
            <i class="bi bi-list-ul me-2"></i>–í—Å–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ
        </h5>
        <div>
            <a href="{% url 'equipments:export_excel' %}?{{ request.GET.urlencode }}" 
               class="btn btn-sm btn-success me-2" title="–≠–∫—Å–ø–æ—Ä—Ç –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è –≤ Excel">
                <i class="bi bi-file-earmark-excel me-1"></i>–≠–∫—Å–ø–æ—Ä—Ç
            </a>
            <a href="/admin/equipments/equipment/add/" class="btn btn-sm btn-primary" target="_blank">
                <i class="bi bi-plus-circle me-1"></i>–î–æ–±–∞–≤–∏—Ç—å
            </a>
        </div>
    </div>

    <div class="card-body">
        <!-- –§–∏–ª—å—Ç—Ä—ã -->
        <div class="row mb-4">
            <div class="col-md-6">
                <form method="get" class="row g-3">
                    <div class="col-md-3">
                        <label class="form-label">–°—Ç–∞—Ç—É—Å</label>
                        <select name="status" class="form-select form-select-sm" onchange="this.form.submit()">
                            <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                            <option value="available" {% if status_filter == 'available' %}selected{% endif %}>–ù–∞ —Å–∫–ª–∞–¥–µ</option>
                            <option value="issued" {% if status_filter == 'issued' %}selected{% endif %}>–í—ã–¥–∞–Ω–æ</option>
                            <option value="broken" {% if status_filter == 'broken' %}selected{% endif %}>–°–ª–æ–º–∞–Ω</option>
                            <option value="repair" {% if status_filter == 'repair' %}selected{% endif %}>–í —Ä–µ–º–æ–Ω—Ç–µ</option>
                            <option value="written_off" {% if status_filter == 'written_off' %}selected{% endif %}>–°–ø–∏—Å–∞–Ω</option>
                        </select>
                    </div>
                    
                    <div class="col-md-3">
                        <label class="form-label">–¢–∏–ø</label>
                        <select name="type" class="form-select form-select-sm" onchange="this.form.submit()">
                            <option value="">–í—Å–µ —Ç–∏–ø—ã</option>
                            <option value="laptop" {% if type_filter == 'laptop' %}selected{% endif %}>–ù–æ—É—Ç–±—É–∫</option>
                            <option value="pc" {% if type_filter == 'pc' %}selected{% endif %}>–ö–æ–º–ø—å—é—Ç–µ—Ä</option>
                            <option value="monitor" {% if type_filter == 'monitor' %}selected{% endif %}>–ú–æ–Ω–∏—Ç–æ—Ä</option>
                            <option value="keyboard" {% if type_filter == 'keyboard' %}selected{% endif %}>–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞</option>
                            <option value="mouse" {% if type_filter == 'mouse' %}selected{% endif %}>–ú—ã—à—å</option>
                            <option value="printer" {% if type_filter == 'printer' %}selected{% endif %}>–ü—Ä–∏–Ω—Ç–µ—Ä</option>
                            <option value="scanner" {% if type_filter == 'scanner' %}selected{% endif %}>–°–∫–∞–Ω–µ—Ä</option>
                            <option value="headphones" {% if type_filter == 'headphones' %}selected{% endif %}>–ù–∞—É—à–Ω–∏–∫–∏</option>
                            <option value="phone" {% if type_filter == 'phone' %}selected{% endif %}>–¢–µ–ª–µ—Ñ–æ–Ω</option>
                            <option value="webcam" {% if type_filter == 'webcam' %}selected{% endif %}>–í–µ–±-–∫–∞–º–µ—Ä–∞</option>
                            <option value="other" {% if type_filter == 'other' %}selected{% endif %}>–î—Ä—É–≥–æ–µ</option>
                        </select>
                    </div>
                    
                    <div class="col-md-3">
                        <label class="form-label">–û—Ç–¥–µ–ª —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</label>
                        <select name="department" class="form-select form-select-sm" onchange="this.form.submit()">
                            <option value="">–í—Å–µ –æ—Ç–¥–µ–ª—ã</option>
                            {% for department in departments %}
                                <option value="{{ department.id }}" 
                                    {% if department_filter|stringformat:"s" == department.id|stringformat:"s" %}selected{% endif %}>
                                    {{ department.name }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div class="col-md-3">
                        <label class="form-label">–ó–∞–∫—Ä–µ–ø–ª–µ–Ω–æ –∑–∞ –æ—Ç–¥–µ–ª–æ–º</label>
                        <select name="assigned_department" class="form-select form-select-sm" onchange="this.form.submit()">
                            <option value="">–í—Å–µ –æ—Ç–¥–µ–ª—ã (–∑–∞–∫—Ä–µ–ø–ª–µ–Ω–∏–µ)</option>
                            {% for department in departments %}
                                <option value="{{ department.id }}" 
                                    {% if assigned_department_filter|stringformat:"s" == department.id|stringformat:"s" %}selected{% endif %}>
                                    {{ department.name }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                </form>
            </div>
            <div class="col-md-6 text-end">
                <span class="text-muted">
                    –í—Å–µ–≥–æ: {{ equipments.count }} –µ–¥–∏–Ω–∏—Ü
                </span>
            </div>
        </div>

        <!-- –¢–∞–±–ª–∏—Ü–∞ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è -->
        {% if equipments %}
        <div class="table-responsive">
            <table class="table table-hover">
                <thead class="table-light">
                    <tr>
                        <th>–ú–¶ –Ω–æ–º–µ—Ä</th>
                        <th>–¢–∏–ø</th>
                        <th>–ú–∞—Ä–∫–∞/–ú–æ–¥–µ–ª—å</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th>–ó–∞–∫—Ä–µ–ø–ª–µ–Ω–æ –∑–∞</th>
                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in equipments %}
                    <tr>
                        <td>
                            {% if item.mc_number %}
                            <strong>{{ item.mc_number }}</strong>
                            {% else %}
                            <strong class="text-muted">–ë–µ–∑ –ú–¶</strong>
                            {% endif %}
                        </td>
                        <td>{{ item.get_type_display }}</td>
                        <td>
                            {% if item.brand or item.model %}
                                {% if item.brand %}{{ item.brand }}{% endif %}
                                {% if item.model %}{{ item.model }}{% endif %}
                            {% else %}
                                <span class="text-muted">–ù–µ —É–∫–∞–∑–∞–Ω–æ</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if item.status == 'available' %}
                                <span class="badge bg-success status-badge">–ù–∞ —Å–∫–ª–∞–¥–µ</span>
                            {% elif item.status == 'issued' %}
                                <span class="badge bg-primary status-badge">–í—ã–¥–∞–Ω–æ</span>
                            {% elif item.status == 'broken' %}
                                <span class="badge bg-danger status-badge">–°–ª–æ–º–∞–Ω</span>
                            {% elif item.status == 'repair' %}
                                <span class="badge bg-warning text-dark status-badge">–í —Ä–µ–º–æ–Ω—Ç–µ</span>
                            {% elif item.status == 'written_off' %}
                                <span class="badge bg-secondary status-badge">–°–ø–∏—Å–∞–Ω</span>
                            {% else %}
                                <span class="badge bg-light text-dark status-badge">{{ item.status }}</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if item.assigned_to %}
                                <a href="{% url 'employees:employee_detail' item.assigned_to.pk %}" class="text-decoration-none">
                                    üë§ {{ item.assigned_to.full_name }}
                                </a>
                                {% if item.assigned_to.department %}
                                    <br><small class="text-muted">{{ item.assigned_to.department.name }}</small>
                                {% endif %}
                            {% elif item.assigned_department %}
                                <span class="text-decoration-none">
                                    üè¢ {{ item.assigned_department.name }}
                                </span>
                            {% else %}
                                <span class="text-muted">–ù–µ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–æ</span>
                            {% endif %}
                        </td>
                        <td>
                            <a href="{% url 'equipments:equipment_detail' item.pk %}" class="btn btn-sm btn-outline-primary">
                                <i class="bi bi-eye"></i>
                            </a>
                            <a href="/admin/equipments/equipment/{{ item.pk }}/change/" 
                               class="btn btn-sm btn-outline-secondary" target="_blank">
                                <i class="bi bi-pencil"></i>
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="text-center py-5">
            <i class="bi bi-inbox display-1 text-muted"></i>
            <h5 class="mt-3">–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h5>
            <p class="text-muted">–î–æ–±–∞–≤—å—Ç–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∫—É</p>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}